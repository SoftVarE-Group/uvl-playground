<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="./split.css">
    <link rel="stylesheet" href="./node_modules/intro.js/introjs.css">
    <link rel="stylesheet" href="./node_modules/intro.js/themes/introjs-modern.css">
    <link rel="stylesheet" href="./style.css">
    <title>UVL Playground</title>
</head>
<body>
<div class="header">
    <h1>UVL Playground</h1>
    <h2 id="connection" style="color: red;"></h2>
</div>
<div class="uvl-tutorial-button" id="uvl-tutorialButton"><div class="uvl-tutorial-button-text">?</div></div>
<div class="tutorial-button" id="tutorialButton"><div class="tutorial-button-text">?</div></div>
<div>
    <dialog id="dialog">
        <div>
            <button autofocus id="modalClose">X</button>
        </div>
        <h1>Get the UVLS VSCode Extension</h1>
        <p>You are trying to access the Configuration Page for Feature Models.
            As by now, the Web-Playground does not support this, but it is available in the VSCode Extension!
            Here is a preview:
        </p>
        <img src="https://raw.githubusercontent.com/Universal-Variability-Language/uvl-lsp/master/img/show_editor.gif"
             id="gif_in_dialog" alt="Preview">
        <p>Get the extension <a href="https://marketplace.visualstudio.com/items?itemName=caradhras.uvls-code">here</a>
        </p>
    </dialog>
</div>
<div id="main-div" style="display: flex;">
    <div class="splitter">
        <div id="first">
            <div id="container" class="editor"></div>
        </div>
        <div id="separator"></div>
    
        <div id="second">
            <div class="graph"></div>
        </div>
    </div>
</div>


<div class="footer">
    <p>The Universal Variability Language (UVL) is a community effort towards a widely adopted textual specification
        for feature models. This playground provides the opportunity to get used to the language with
        syntax-highlighting, autocompletion, and simple analysis. It is based on the <a
                href="https://github.com/Universal-Variability-Language/uvl-lsp">UVL Language Server</a>. To fully
        use all features use the UVLS - Universal Variability Language Server extension for visual studio code. </p>
</div>
<script type="module">
    import {startUvlClient} from "./src/main.ts";

    startUvlClient();
</script>
<script>
    // A function is used for dragging and moving
    function dragElement(element, direction) {
        var md; // remember mouse down info
        const first = document.getElementById("first");
        const second = document.getElementById("second");

        element.onmousedown = onMouseDown;

        function onMouseDown(e) {
            //console.log("mouse down: " + e.clientX);
            md = {
                e,
                offsetLeft: element.offsetLeft,
                offsetTop: element.offsetTop,
                firstWidth: first.offsetWidth,
                secondWidth: second.offsetWidth
            };

            document.onmousemove = onMouseMove;
            document.onmouseup = () => {
                //console.log("mouse up");
                document.onmousemove = document.onmouseup = null;
            }
        }

        function onMouseMove(e) {
            //console.log("mouse move: " + e.clientX);
            var delta = {
                x: e.clientX - md.e.clientX,
                y: e.clientY - md.e.clientY
            };

            if (direction === "H") // Horizontal
            {
                // Prevent negative-sized elements
                delta.x = Math.min(Math.max(delta.x, -md.firstWidth),
                    md.secondWidth);

                element.style.left = md.offsetLeft + delta.x + "px";
                first.style.width = (md.firstWidth + delta.x) + "px";
                second.style.width = (md.secondWidth - delta.x) + "px";
            }
        }
    }


    dragElement(document.getElementById("separator"), "H");
</script>
<script>
    const tutorialContent = [
        {title: "Welcome!", text: "Welcome to the UVL Tutorial. All code listings will automatically be placed in the editor on the left. Click 'Next' to start the tutorial."},
        {title: "Basic Feature Model!", text: "Start with the 'features' key word to start enumerating your features. Indentations matter in UVL and represent the tree structure.", codeListing: "features\n\tfeature1\n\tfeature2"},
        {title: "Feature Groups", text: "You can use 'alternative', 'mandatory', 'optional', and 'or', to create groups.", codeListing: "features\n\tfeature1\n\tfeature2"}
    ]
    let tutorialToogle = false;
    var uvlTutorialButton = document.getElementById("uvl-tutorialButton");
    uvlTutorialButton.addEventListener('click', function() {
        let tutorialPageCounter = 0;
        tutorialToogle = !tutorialToogle;
        let mainDiv = document.getElementById("main-div");
        let splitter = document.getElementsByClassName("splitter")[0];
        if(tutorialToogle){
            splitter.style.width = "75%";
            setTutorialPage(mainDiv, tutorialPageCounter);
        }else{
            splitter.style.width = "100%";
            let newDiv = document.getElementById("uvl-tutorial-div");
            mainDiv.removeChild(newDiv);
        }
    });

    function setTutorialPage(mainDiv, pageNumber){
        let tutorialDiv = document.getElementById("uvl-tutorial-div");
        if(tutorialDiv !== null){
            mainDiv.removeChild(tutorialDiv);
        }
        tutorialDiv = getTutorialPage(mainDiv, pageNumber);
        mainDiv.appendChild(tutorialDiv);
    }

    function getTutorialPage(mainDiv, pageNumber){
        const content = tutorialContent[pageNumber];
        let newDiv = document.createElement('div');
        newDiv.id = "uvl-tutorial-div";
        newDiv.style.color = "white";
        newDiv.style.position = "relative";
        newDiv.style.width = "100%";
        let headline = document.createElement('h2');
        headline.textContent = content.title;
        let text = document.createElement('div');
        text.textContent = content.text;
        
        let navigationContainer = document.createElement('div');
        navigationContainer.style.position = "absolute";
        navigationContainer.style.bottom = 0;
        navigationContainer.style.display = "flex";
        navigationContainer.style.justifyContent = "space-between";
        navigationContainer.style.width = "90%";
        navigationContainer.style.padding = "10px";
        let backButton = document.createElement('div');
        if(pageNumber > 0){
            backButton = document.createElement('button');
            backButton.textContent = "Back";
            backButton.style.backgroundColor = "#1e1e1e";
            backButton.style.color = "#fff";
            backButton.style.border= "2px solid 'fff";
            backButton.style.borderRadius = "10%";
            backButton.style.padding = "10px 20px";
            backButton.style.cursor = "pointer";
            backButton.style.fontSize = "16px";
            backButton.onclick = () => {
                setTutorialPage(mainDiv, pageNumber - 1);
            } 
        }
        navigationContainer.appendChild(backButton);
        let nextButton = document.createElement('button');        
        nextButton.style.backgroundColor = "#1e1e1e";
        nextButton.style.color = "#fff";
        nextButton.style.border= "2px solid 'fff";
        nextButton.style.borderRadius = "10%";
        nextButton.style.padding = "10px 20px";
        nextButton.style.cursor = "pointer";
        nextButton.style.fontSize = "16px";
        if(pageNumber < tutorialContent.length - 1){
            nextButton.textContent = "Next";
            nextButton.onclick = () => {
                setTutorialPage(mainDiv, pageNumber + 1);
            } 
        }else{
            nextButton.textContent = "Done";
            nextButton.onclick = () => {
                let splitter = document.getElementsByClassName("splitter")[0];
                splitter.style.width = "100%";
                let newDiv = document.getElementById("uvl-tutorial-div");
                mainDiv.removeChild(newDiv);
                tutorialToogle = !tutorialToogle;
            } 
        }
        navigationContainer.appendChild(nextButton);
        
        newDiv.appendChild(headline);
        newDiv.appendChild(text);
        newDiv.appendChild(navigationContainer);
        const editor = window.editor;
        if(editor && content.codeListing !== undefined){
            editor.setValue(content.codeListing);
        }
        return newDiv;
    }
    
</script>
</body>
</html>
